var certificate={validateFile:function(e){if("file"!=jQuery(e).attr("type"))return!1;jQuery("#system-message-container").empty();var r=jQuery(e)[0].files[0],t=r.type,a=r.name.split("."),s=allowedAttachments.split(","),i=0,n=new Array;return""===a[a.length-1]&&null===a[a.length-1]||-1!=jQuery.inArray(t,s)||(i="1",n.push(Joomla.JText._("COM_TJCERTIFICATE_MEDIA_INVALID_FILE_TYPE"))),r.size>1024*attachmentMaxSize*1024&&(i="1",n.push(Joomla.JText._("COM_TJCERTIFICATE_MEDIA_UPLOAD_ERROR")),console.log("COM_TIMELOG_FILE_SIZE_ERROR")),i?(Joomla.renderMessages({error:n}),jQuery("html, body").animate({scrollTop:0},500),!1):void 0},deleteAttachment:function(e){if(1==confirm(Joomla.JText._("COM_TJCERTIFICATE_CONFIRM_DELETE_ATTACHMENT"))){var r={};if(""==e||void 0===e)return!1;r.certificateId=jQuery(e).attr("data-aid"),r.mediaId=jQuery(e).attr("data-mid"),tjCertificateService.deleteAttachment(r).fail(function(e){var r={error:[e.responseText]};certificate.renderMessage(r)}).done(function(r){if(!r.success&&r.message){var t={error:[r.message]};certificate.renderMessage(t)}r.messages&&certificate.renderMessage(r.messages),r.success&&certificate.renderMessage(r.message),jQuery(e).closest("span.fileupload").remove()})}},deleteItem:function(e,r){if(1==confirm(Joomla.JText._("COM_TJCERTIFICATE_DELETE_CERTIFICATE_MESSAGE"))){var t={};if(""==e||void 0===e)return!1;t.certificateId=e,tjCertificateService.deleteItem(t).fail(function(e){var r={error:[e.responseText]};certificate.renderMessage(r)}).done(function(e){if(!e.success&&e.message){var t={error:[e.message]};certificate.renderMessage(t)}e.messages&&certificate.renderMessage(e.messages),e.success&&certificate.renderMessage(e.message),jQuery(r).closest("tr").remove()})}},renderMessage:function(e){Joomla.renderMessages({"alert alert-success":[e]}),jQuery("html, body").animate({scrollTop:0},2e3)},validationEndDate:function(e){var r=jQuery(e).val(),t=jQuery("#jform_issued_on").val();jQuery(document).ready(function(){document.formvalidator.setHandler("expdate",function(e){return!(t>r)||(certificate.renderMessage(Joomla.JText._("COM_TJCERTIFICATE_EXPIRY_DATE_VALIDATION_MESSAGE")),jQuery("#jform_expired_on").val(""),!1)})})},getAgencyUsers:function(e){var r={},t=jQuery("#jform_assigned_user_id"),a=jQuery("#assigned_user_id").val();r.agency_id=jQuery(e).val(),tjCertificateService.getAgencyUsers(r).fail(function(e){var r={error:[e.responseText]};Joomla.renderMessage(r)}).done(function(e){if(!e)return!1;if(e.success){t.empty(),t.trigger("liszt:updated");for(var r=e.data,s=0;s<r.length;++s)selectOption="",a==r[s].value&&(selectOption=' selected="selected" '),op="<option value='"+r[s].value+"' "+selectOption+" > "+r[s].text+"</option>",t.append(op);t.trigger("liszt:updated")}})}};
